import { jsx as _jsx, jsxs as _jsxs } from "react/jsx-runtime";
import { Card, CardContent, CardHeader, CardTitle, CardDescription } from "./ui/card";
import { Progress } from "./ui/progress";
import { Users, FileText, Clock, Target } from 'lucide-react';
import { BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, PieChart, Pie, Cell } from 'recharts';
import { LineChart, Line } from 'recharts';
import { MyResponsesResults } from './MyResponsesResults';
export function EmployeeExperienceSection({ categoryData, driverData, overallPercentage, distribution, surveyResponses, moduleId }) {
    const CustomTooltip = ({ active, payload, label }) => {
        if (active && payload && payload.length) {
            const data = payload[0].payload;
            return (_jsxs("div", { className: "bg-white p-3 border rounded-lg shadow-lg", children: [_jsx("p", { className: "font-medium", children: label }), _jsxs("p", { className: "text-green-600", children: ["Positive Responses: ", data.positivePercentage.toFixed(1), "%"] }), _jsxs("p", { className: "text-sm text-gray-600", children: [data.positiveCount, " of ", data.totalCount, " responses"] })] }));
        }
        return null;
    };
    // Sort data by positive percentage
    const sortedCategoryData = [...categoryData].sort((a, b) => b.positivePercentage - a.positivePercentage);
    const sortedDriverData = [...driverData].sort((a, b) => b.positivePercentage - a.positivePercentage);
    // Prepare distribution data for charts
    const distribution1to5 = Object.entries(distribution['1-5']).map(([score, count]) => ({
        score: `${score}`,
        count,
        isPositive: parseInt(score) >= 4
    }));
    const distribution0to10 = Object.entries(distribution['0-10']).map(([score, count]) => ({
        score: `${score}`,
        count,
        isPositive: parseInt(score) >= 7
    }));
    const COLORS = {
        positive: '#16a34a',
        neutral: '#6b7280'
    };
    // Mock daily responses for the Daily Responses chart (can be replaced with real data)
    const dailyResponses = [
        { day: 'Mon', responses: 8 },
        { day: 'Tue', responses: 12 },
        { day: 'Wed', responses: 10 },
        { day: 'Thu', responses: 14 },
        { day: 'Fri', responses: 9 },
        { day: 'Sat', responses: 4 },
        { day: 'Sun', responses: 6 }
    ];
    // Mock demographic distribution for department pie (derive from categories if available)
    const demographicData = sortedCategoryData.slice(0, 5).map((c, i) => ({
        name: c.driver,
        value: c.totalCount || Math.max(1, Math.round(c.positivePercentage)),
        color: ['#3B82F6', '#10B981', '#F59E0B', '#EF4444', '#8B5CF6'][i % 5]
    }));
    return (_jsxs("div", { className: "space-y-6", children: [_jsxs("div", { className: "grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4", children: [_jsxs(Card, { children: [_jsxs(CardHeader, { className: "flex items-center justify-between pb-2", children: [_jsx("div", { children: _jsx(CardTitle, { className: "text-sm font-medium text-gray-600", children: "Average Positive Score" }) }), _jsx("div", { children: _jsx(Target, { className: "h-4 w-4 text-blue-600" }) })] }), _jsxs(CardContent, { children: [_jsxs("div", { className: "text-2xl font-bold text-green-800", children: [overallPercentage.toFixed(1), "%"] }), _jsx("p", { className: "text-xs text-gray-600 mt-1", children: "Responses scoring positive on the scale" })] })] }), _jsxs(Card, { children: [_jsxs(CardHeader, { className: "flex items-center justify-between pb-2", children: [_jsx("div", { children: _jsx(CardTitle, { className: "text-sm font-medium text-gray-600", children: "Completion Rate" }) }), _jsx("div", { children: _jsx(Users, { className: "h-4 w-4 text-green-600" }) })] }), _jsxs(CardContent, { children: [_jsx("div", { className: "text-2xl font-bold", children: (() => {
                                            try {
                                                const total = sortedCategoryData.reduce((s, c) => s + (c.totalCount || 0), 0) || 0;
                                                const positive = sortedCategoryData.reduce((s, c) => s + (c.positiveCount || 0), 0) || 0;
                                                return total > 0 ? `${Math.round((positive / total) * 100)}%` : '—';
                                            }
                                            catch {
                                                return '—';
                                            }
                                        })() }), _jsx("p", { className: "text-xs text-gray-600 mt-1", children: "Based on available responses" })] })] }), _jsxs(Card, { children: [_jsxs(CardHeader, { className: "flex items-center justify-between pb-2", children: [_jsx("div", { children: _jsx(CardTitle, { className: "text-sm font-medium text-gray-600", children: "Median Question Score" }) }), _jsx("div", { children: _jsx(FileText, { className: "h-4 w-4 text-purple-600" }) })] }), _jsxs(CardContent, { children: [_jsxs("div", { className: "text-2xl font-bold", children: [Math.max(0, overallPercentage - 2).toFixed(1), "%"] }), _jsx("p", { className: "text-xs text-gray-600 mt-1", children: "Middle score across all questions" })] })] }), _jsxs(Card, { children: [_jsxs(CardHeader, { className: "flex items-center justify-between pb-2", children: [_jsx("div", { children: _jsx(CardTitle, { className: "text-sm font-medium text-gray-600", children: "Top Demographic" }) }), _jsx("div", { children: _jsx(Clock, { className: "h-4 w-4 text-orange-600" }) })] }), _jsxs(CardContent, { children: [_jsxs("div", { className: "text-lg font-semibold", children: [sortedCategoryData[0]?.driver ?? 'Product Ops', " ", sortedCategoryData[0] ? `${Math.round(sortedCategoryData[0].positivePercentage)}%` : '87%'] }), _jsx("p", { className: "text-xs text-gray-600 mt-1", children: "Highest scoring group" })] })] })] }), _jsxs("div", { className: "mt-2 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4", children: [_jsxs(Card, { children: [_jsxs(CardHeader, { className: "flex items-center justify-between pb-2", children: [_jsx(CardTitle, { className: "text-sm font-medium text-gray-600", children: "Total Participants" }), _jsx(Users, { className: "h-4 w-4 text-blue-600" })] }), _jsxs(CardContent, { children: [_jsx("div", { className: "text-2xl font-bold", children: sortedCategoryData.reduce((s, c) => s + (c.totalCount || 0), 0) || '—' }), _jsx("p", { className: "text-xs text-gray-600 mt-1", children: "Invited to this survey" })] })] }), _jsxs(Card, { children: [_jsxs(CardHeader, { className: "flex items-center justify-between pb-2", children: [_jsx(CardTitle, { className: "text-sm font-medium text-gray-600", children: "Surveys Completed" }), _jsx(FileText, { className: "h-4 w-4 text-green-600" })] }), _jsxs(CardContent, { children: [_jsx("div", { className: "text-2xl font-bold", children: sortedCategoryData.reduce((s, c) => s + (c.positiveCount || 0), 0) || '—' }), _jsx("p", { className: "text-xs text-gray-600 mt-1", children: "Successfully submitted" })] })] }), _jsxs(Card, { children: [_jsxs(CardHeader, { className: "flex items-center justify-between pb-2", children: [_jsx(CardTitle, { className: "text-sm font-medium text-gray-600", children: "Active Respondents" }), _jsx(Target, { className: "h-4 w-4 text-orange-600" })] }), _jsxs(CardContent, { children: [_jsx("div", { className: "text-2xl font-bold", children: Math.max(0, Math.round((overallPercentage || 0) / 10)) }), _jsx("p", { className: "text-xs text-gray-600 mt-1", children: "Currently in progress" })] })] }), _jsxs(Card, { children: [_jsxs(CardHeader, { className: "flex items-center justify-between pb-2", children: [_jsx(CardTitle, { className: "text-sm font-medium text-gray-600", children: "Avg Time to Complete" }), _jsx(Clock, { className: "h-4 w-4 text-purple-600" })] }), _jsxs(CardContent, { children: [_jsx("div", { className: "text-2xl font-bold", children: "11.4 min" }), _jsx("p", { className: "text-xs text-gray-600 mt-1", children: "Average completion time" })] })] })] }), _jsxs(Card, { children: [_jsxs(CardHeader, { children: [_jsx(CardTitle, { children: "Employee Experience Overview" }), _jsx(CardDescription, { children: "Overall driver and category breakdown" })] }), _jsx(CardContent, { children: _jsx("div", { className: "flex items-center justify-center space-x-8", children: _jsxs("div", { className: "text-center", children: [_jsxs("div", { className: "text-4xl font-bold text-green-600 mb-2", children: [overallPercentage.toFixed(1), "%"] }), _jsx("div", { className: "text-lg font-medium text-gray-700", children: "Overall Positive Experience" }), _jsx("div", { className: "mt-4 w-64", children: _jsx(Progress, { value: overallPercentage, className: "h-3" }) })] }) }) })] }), _jsxs(Card, { children: [_jsxs(CardHeader, { children: [_jsx(CardTitle, { children: "Performance by Category" }), _jsx("p", { className: "text-sm text-muted-foreground", children: "Positive response rates across employee experience categories" })] }), _jsxs(CardContent, { children: [_jsx("div", { className: "h-80 mb-6", children: _jsx(ResponsiveContainer, { width: "100%", height: "100%", children: _jsxs(BarChart, { data: sortedCategoryData, margin: { top: 20, right: 30, left: 20, bottom: 60 }, children: [_jsx(CartesianGrid, { strokeDasharray: "3 3" }), _jsx(XAxis, { dataKey: "driver", angle: -45, textAnchor: "end", height: 80 }), _jsx(YAxis, { domain: [0, 100], label: { value: 'Positive %', angle: -90, position: 'insideLeft' } }), _jsx(Tooltip, { content: _jsx(CustomTooltip, {}) }), _jsx(Bar, { dataKey: "positivePercentage", fill: "#16a34a", radius: [4, 4, 0, 0] })] }) }) }), _jsx("div", { className: "grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4", children: sortedCategoryData.map((category) => (_jsxs("div", { className: "text-center p-4 bg-gray-50 rounded-lg", children: [_jsxs("div", { className: "text-2xl font-bold text-green-600 mb-1", children: [category.positivePercentage.toFixed(1), "%"] }), _jsx("div", { className: "text-sm font-medium text-gray-700", children: category.driver }), _jsxs("div", { className: "text-xs text-gray-500 mt-1", children: [category.positiveCount, "/", category.totalCount, " positive"] })] }, category.driver))) })] })] }), _jsxs(Card, { children: [_jsx(CardHeader, { children: _jsx(CardTitle, { children: "Detailed Driver Analysis" }) }), _jsx(CardContent, { children: _jsxs("div", { className: "grid grid-cols-1 lg:grid-cols-2 gap-6", children: [_jsxs("div", { children: [_jsx("h4", { className: "font-medium mb-4 text-green-700", children: "Top Performing Drivers" }), _jsx("div", { className: "space-y-3", children: sortedDriverData.slice(0, 6).map((driver) => (_jsxs("div", { className: "p-3 bg-green-50 rounded-lg", children: [_jsxs("div", { className: "flex justify-between items-start mb-2", children: [_jsx("span", { className: "text-sm font-medium text-gray-800 flex-1 pr-2", children: driver.driver }), _jsxs("span", { className: "text-lg font-bold text-green-600", children: [driver.positivePercentage.toFixed(1), "%"] })] }), _jsx("div", { className: "w-full bg-green-200 rounded-full h-2", children: _jsx("div", { className: "bg-green-600 h-2 rounded-full", style: { width: `${driver.positivePercentage}%` } }) })] }, driver.driver))) })] }), _jsxs("div", { children: [_jsx("h4", { className: "font-medium mb-4 text-orange-700", children: "Areas for Improvement" }), _jsx("div", { className: "space-y-3", children: sortedDriverData.slice(-6).reverse().map((driver) => (_jsxs("div", { className: "p-3 bg-orange-50 rounded-lg", children: [_jsxs("div", { className: "flex justify-between items-start mb-2", children: [_jsx("span", { className: "text-sm font-medium text-gray-800 flex-1 pr-2", children: driver.driver }), _jsxs("span", { className: "text-lg font-bold text-orange-600", children: [driver.positivePercentage.toFixed(1), "%"] })] }), _jsx("div", { className: "w-full bg-orange-200 rounded-full h-2", children: _jsx("div", { className: "bg-orange-600 h-2 rounded-full", style: { width: `${driver.positivePercentage}%` } }) })] }, driver.driver))) })] })] }) })] }), _jsxs("div", { className: "grid grid-cols-1 lg:grid-cols-2 gap-6", children: [_jsxs(Card, { children: [_jsxs(CardHeader, { children: [_jsx(CardTitle, { children: "Daily Responses" }), _jsx(CardDescription, { children: "Response activity over the survey period" })] }), _jsx(CardContent, { children: _jsx("div", { style: { width: '100%', height: 250 }, children: _jsx(ResponsiveContainer, { width: "100%", height: 250, children: _jsxs(LineChart, { data: dailyResponses, children: [_jsx(CartesianGrid, { strokeDasharray: "3 3" }), _jsx(XAxis, { dataKey: "day" }), _jsx(YAxis, {}), _jsx(Tooltip, {}), _jsx(Line, { type: "monotone", dataKey: "responses", stroke: "#3B82F6", strokeWidth: 2 })] }) }) }) })] }), _jsxs(Card, { children: [_jsxs(CardHeader, { children: [_jsx(CardTitle, { children: "Response Distribution by Department" }), _jsx(CardDescription, { children: "Participation across organizational units" })] }), _jsxs(CardContent, { children: [_jsx("div", { style: { width: '100%', height: 250 }, children: _jsx(ResponsiveContainer, { width: "100%", height: 250, children: _jsxs(PieChart, { children: [_jsx(Pie, { data: demographicData, dataKey: "value", cx: "50%", cy: "50%", innerRadius: 40, outerRadius: 80, paddingAngle: 4, children: demographicData.map((entry, index) => (_jsx(Cell, { fill: entry.color }, `cell-${index}`))) }), _jsx(Tooltip, { formatter: (value) => [`${value}`, 'Responses'] })] }) }) }), _jsx("div", { className: "flex flex-wrap gap-2 mt-4 justify-center", children: demographicData.map((item) => (_jsxs("div", { className: "text-xs inline-flex items-center gap-2 px-2 py-1 bg-gray-100 rounded-full", children: [_jsx("span", { className: "w-2 h-2 rounded-full", style: { backgroundColor: item.color } }), item.name] }, item.name))) })] })] })] }), surveyResponses && moduleId && (_jsx("div", { className: "mt-6", children: _jsx(MyResponsesResults, { surveyResponses: surveyResponses, module: moduleId }) })), _jsxs(Card, { children: [_jsxs(CardHeader, { children: [_jsx(CardTitle, { children: "Response Distribution Context" }), _jsx("p", { className: "text-sm text-muted-foreground", children: "Distribution of responses across different scales" })] }), _jsx(CardContent, { children: _jsxs("div", { className: "grid grid-cols-1 lg:grid-cols-2 gap-6", children: [_jsxs("div", { children: [_jsx("h4", { className: "font-medium mb-4", children: "1-5 Scale Distribution" }), _jsx(ResponsiveContainer, { width: "100%", height: 250, children: _jsxs(BarChart, { data: distribution1to5, children: [_jsx(CartesianGrid, { strokeDasharray: "3 3" }), _jsx(XAxis, { dataKey: "score" }), _jsx(YAxis, {}), _jsx(Tooltip, {}), _jsx(Bar, { dataKey: "count", fill: (entry) => entry?.isPositive ? COLORS.positive : COLORS.neutral, children: distribution1to5.map((entry, index) => (_jsx(Cell, { fill: entry.isPositive ? COLORS.positive : COLORS.neutral }, `cell-${index}`))) })] }) })] }), _jsxs("div", { children: [_jsx("h4", { className: "font-medium mb-4", children: "0-10 Scale Distribution (NPS)" }), _jsx(ResponsiveContainer, { width: "100%", height: 250, children: _jsxs(BarChart, { data: distribution0to10, children: [_jsx(CartesianGrid, { strokeDasharray: "3 3" }), _jsx(XAxis, { dataKey: "score" }), _jsx(YAxis, {}), _jsx(Tooltip, {}), _jsx(Bar, { dataKey: "count", fill: (entry) => entry?.isPositive ? COLORS.positive : COLORS.neutral, children: distribution0to10.map((entry, index) => (_jsx(Cell, { fill: entry.isPositive ? COLORS.positive : COLORS.neutral }, `cell-${index}`))) })] }) })] })] }) })] })] }));
}
