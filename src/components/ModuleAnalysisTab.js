import { jsx as _jsx, jsxs as _jsxs } from "react/jsx-runtime";
import { useState } from 'react';
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "./ui/card";
import { Tabs, TabsContent, TabsList, TabsTrigger } from "./ui/tabs";
import { Badge } from "./ui/badge";
import { Button } from "./ui/button";
import { TrendingUp, TrendingDown, Award, AlertTriangle, BarChart3, Users, Eye } from "lucide-react";
import { BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, LineChart, Line } from 'recharts';
import { MyResponsesResults } from './MyResponsesResults';
export function ModuleAnalysisTab({ moduleTitle, summaryMetrics, questionScores, demographicData = [], sectionData = [], surveyResponses, moduleId }) {
    const [selectedFilter, setSelectedFilter] = useState('all');
    const [viewMode, setViewMode] = useState('all');
    // Filter questions based on view mode
    const filteredQuestions = questionScores.filter(q => {
        switch (viewMode) {
            case 'high-impact':
                return q.score >= 80;
            case 'needs-attention':
                return q.score < 60;
            default:
                return true;
        }
    }).sort((a, b) => b.score - a.score);
    // Mock trend data
    const trendData = [
        { period: 'Q1', score: summaryMetrics.positiveAverage - 8 },
        { period: 'Q2', score: summaryMetrics.positiveAverage - 4 },
        { period: 'Q3', score: summaryMetrics.positiveAverage - 1 },
        { period: 'Q4', score: summaryMetrics.positiveAverage }
    ];
    const getScoreColor = (score) => {
        if (score >= 80)
            return 'text-green-600';
        if (score >= 60)
            return 'text-yellow-600';
        return 'text-red-600';
    };
    const getScoreBgColor = (score) => {
        if (score >= 80)
            return 'bg-green-50 border-green-200';
        if (score >= 60)
            return 'bg-yellow-50 border-yellow-200';
        return 'bg-red-50 border-red-200';
    };
    return (_jsxs("div", { className: "space-y-6", children: [_jsxs("div", { className: "grid grid-cols-1 md:grid-cols-4 gap-4", children: [_jsxs(Card, { children: [_jsxs(CardHeader, { className: "flex flex-row items-center justify-between space-y-0 pb-2", children: [_jsx(CardTitle, { className: "text-sm font-medium text-gray-600", children: "Positive Response Average" }), _jsx(BarChart3, { className: "h-4 w-4 text-blue-600" })] }), _jsxs(CardContent, { children: [_jsxs("div", { className: "text-2xl font-bold", children: [summaryMetrics.positiveAverage.toFixed(1), "%"] }), _jsxs("div", { className: "flex items-center gap-1 mt-1", children: [summaryMetrics.trend >= 0 ? (_jsx(TrendingUp, { className: "h-3 w-3 text-green-600" })) : (_jsx(TrendingDown, { className: "h-3 w-3 text-red-600" })), _jsxs("p", { className: `text-xs ${summaryMetrics.trend >= 0 ? 'text-green-600' : 'text-red-600'}`, children: [summaryMetrics.trend >= 0 ? '+' : '', summaryMetrics.trend.toFixed(1), "% vs last quarter"] })] })] })] }), _jsxs(Card, { children: [_jsxs(CardHeader, { className: "flex flex-row items-center justify-between space-y-0 pb-2", children: [_jsx(CardTitle, { className: "text-sm font-medium text-gray-600", children: "Score Range" }), _jsx(Award, { className: "h-4 w-4 text-yellow-600" })] }), _jsxs(CardContent, { children: [_jsxs("div", { className: "text-2xl font-bold", children: [Math.min(...questionScores.map(q => q.score)).toFixed(0), " - ", Math.max(...questionScores.map(q => q.score)).toFixed(0), "%"] }), _jsx("p", { className: "text-xs text-gray-600 mt-1", children: "Question score spread" })] })] }), _jsxs(Card, { children: [_jsxs(CardHeader, { className: "flex flex-row items-center justify-between space-y-0 pb-2", children: [_jsx(CardTitle, { className: "text-sm font-medium text-gray-600", children: "Total Responses" }), _jsx(Users, { className: "h-4 w-4 text-green-600" })] }), _jsxs(CardContent, { children: [_jsx("div", { className: "text-2xl font-bold", children: summaryMetrics.responseCount }), _jsxs("p", { className: "text-xs text-gray-600 mt-1", children: ["Across ", summaryMetrics.totalQuestions, " questions"] })] })] }), _jsxs(Card, { children: [_jsxs(CardHeader, { className: "flex flex-row items-center justify-between space-y-0 pb-2", children: [_jsx(CardTitle, { className: "text-sm font-medium text-gray-600", children: "High Performers" }), _jsx(AlertTriangle, { className: "h-4 w-4 text-purple-600" })] }), _jsxs(CardContent, { children: [_jsx("div", { className: "text-2xl font-bold", children: questionScores.filter(q => q.score >= 80).length }), _jsx("p", { className: "text-xs text-gray-600 mt-1", children: "Questions scoring 80%+" })] })] })] }), _jsxs(Card, { children: [_jsxs(CardHeader, { children: [_jsx(CardTitle, { children: "Score Trend" }), _jsx(CardDescription, { children: "Quarterly performance progression" })] }), _jsx(CardContent, { children: _jsx(ResponsiveContainer, { width: "100%", height: 200, children: _jsxs(LineChart, { data: trendData, children: [_jsx(CartesianGrid, { strokeDasharray: "3 3" }), _jsx(XAxis, { dataKey: "period" }), _jsx(YAxis, { domain: ['dataMin - 5', 'dataMax + 5'] }), _jsx(Tooltip, { formatter: (value) => [`${value}%`, 'Score'] }), _jsx(Line, { type: "monotone", dataKey: "score", stroke: "#3B82F6", strokeWidth: 3, dot: { fill: '#3B82F6', strokeWidth: 2, r: 4 } })] }) }) })] }), _jsxs(Tabs, { defaultValue: "questions", className: "w-full", children: [_jsxs("div", { className: "flex items-center justify-between mb-4", children: [_jsxs(TabsList, { children: [_jsx(TabsTrigger, { value: "questions", children: "Question Scores" }), sectionData.length > 0 && (_jsx(TabsTrigger, { value: "sections", children: "Sections" })), demographicData.length > 0 && (_jsx(TabsTrigger, { value: "demographics", children: "Demographics" })), surveyResponses && moduleId && (_jsx(TabsTrigger, { value: "my-responses", children: "My Responses" }))] }), _jsxs("div", { className: "flex items-center gap-2", children: [_jsxs(Button, { variant: viewMode === 'all' ? 'default' : 'outline', size: "sm", onClick: () => setViewMode('all'), children: [_jsx(Eye, { className: "h-4 w-4 mr-1" }), "All Questions"] }), _jsxs(Button, { variant: viewMode === 'high-impact' ? 'default' : 'outline', size: "sm", onClick: () => setViewMode('high-impact'), children: [_jsx(Award, { className: "h-4 w-4 mr-1" }), "High Impact"] }), _jsxs(Button, { variant: viewMode === 'needs-attention' ? 'default' : 'outline', size: "sm", onClick: () => setViewMode('needs-attention'), children: [_jsx(AlertTriangle, { className: "h-4 w-4 mr-1" }), "Needs Attention"] })] })] }), _jsx(TabsContent, { value: "questions", className: "space-y-4", children: _jsx("div", { className: "space-y-3", children: filteredQuestions.length === 0 ? (_jsx(Card, { className: "p-8 text-center", children: _jsx("p", { className: "text-gray-500", children: "No questions match the current filter criteria." }) })) : (filteredQuestions.map((question, index) => (_jsx(Card, { className: getScoreBgColor(question.score), children: _jsx(CardContent, { className: "p-4", children: _jsxs("div", { className: "flex items-center justify-between", children: [_jsxs("div", { className: "flex-1 pr-4", children: [_jsx("p", { className: "font-medium text-gray-900", children: question.question }), question.section && (_jsx(Badge, { variant: "outline", className: "mt-1 text-xs", children: question.section }))] }), _jsxs("div", { className: "text-right", children: [_jsxs("div", { className: `text-xl font-bold ${getScoreColor(question.score)}`, children: [question.score.toFixed(1), "%"] }), _jsx("div", { className: "w-24 bg-gray-200 rounded-full h-2 mt-1", children: _jsx("div", { className: `h-2 rounded-full ${question.score >= 80 ? 'bg-green-500' :
                                                                question.score >= 60 ? 'bg-yellow-500' : 'bg-red-500'}`, style: { width: `${question.score}%` } }) })] })] }) }) }, index)))) }) }), sectionData.length > 0 && (_jsx(TabsContent, { value: "sections", children: _jsxs(Card, { children: [_jsxs(CardHeader, { children: [_jsx(CardTitle, { children: "Section Performance" }), _jsx(CardDescription, { children: "Average scores by section" })] }), _jsx(CardContent, { children: _jsx(ResponsiveContainer, { width: "100%", height: 300, children: _jsxs(BarChart, { data: sectionData, layout: "horizontal", children: [_jsx(CartesianGrid, { strokeDasharray: "3 3" }), _jsx(XAxis, { type: "number", domain: [0, 100] }), _jsx(YAxis, { dataKey: "section", type: "category", width: 120 }), _jsx(Tooltip, { formatter: (value) => [`${value}%`, 'Score'] }), _jsx(Bar, { dataKey: "score", fill: "#3B82F6" })] }) }) })] }) })), demographicData.length > 0 && (_jsx(TabsContent, { value: "demographics", children: _jsxs(Card, { children: [_jsxs(CardHeader, { children: [_jsx(CardTitle, { children: "Demographic Performance" }), _jsx(CardDescription, { children: "Scores by department/group" })] }), _jsx(CardContent, { children: _jsx(ResponsiveContainer, { width: "100%", height: 300, children: _jsxs(BarChart, { data: demographicData, children: [_jsx(CartesianGrid, { strokeDasharray: "3 3" }), _jsx(XAxis, { dataKey: "department" }), _jsx(YAxis, { domain: [0, 100] }), _jsx(Tooltip, { formatter: (value) => [`${value}%`, 'Score'] }), _jsx(Bar, { dataKey: "score", fill: "#10B981" })] }) }) })] }) })), surveyResponses && moduleId && (_jsx(TabsContent, { value: "my-responses", children: _jsx(MyResponsesResults, { surveyResponses: surveyResponses, module: moduleId }) }))] })] }));
}
